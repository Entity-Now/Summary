import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as s,c as a,a as p}from"./app-d39e34ec.js";const t={},e=p(`<h1 id="使用canvas画饼图" tabindex="-1"><a class="header-anchor" href="#使用canvas画饼图" aria-hidden="true">#</a> 使用canvas画饼图</h1><p>您可以使用 js 的 requestAnimationFrame() 方法来添加动画效果。这个方法会在浏览器的下一次重绘之前调用指定的函数，从而实现平滑的动画¹³。要使用这个方法，您需要以下步骤：</p><ul><li>定义一个变量来存储动画的进度，初始值为 0。</li><li>定义一个函数来更新饼状图的数据，根据进度变量来计算每个扇形的结束角度。</li><li>在函数中，使用 requestAnimationFrame() 方法来递归地调用自身，直到进度变量达到 1。</li><li>在函数中，使用 clearRect() 方法来清除画布上的内容，然后重新绘制饼状图。</li></ul><p>例如，以下代码会给上面的饼状图添加一个简单的动画效果：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 获取 canvas 元素和绘图上下文对象</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;pie-chart&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 定义饼状图的数据</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&quot;A&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&quot;B&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&quot;C&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;yellow&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&quot;D&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 计算总和和比例</span>
<span class="token keyword">var</span> total <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sum<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sum <span class="token operator">+</span> item<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ratio <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>value <span class="token operator">/</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 定义圆心和半径</span>
<span class="token keyword">var</span> cx <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> cy <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> radius <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">// 定义起始角度</span>
<span class="token keyword">var</span> startAngle <span class="token operator">=</span> <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">// 定义动画进度变量</span>
<span class="token keyword">var</span> progress <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">// 定义更新饼状图的函数</span>
<span class="token keyword">function</span> <span class="token function">updateChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
   <span class="token comment">// 清除画布内容 </span>
   ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">,</span><span class="token number">0</span> <span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>width <span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// 遍历数据，绘制每个扇形 </span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// 计算结束角度（乘以进度变量）</span>
     <span class="token keyword">var</span> endAngle<span class="token operator">=</span> startAngle <span class="token operator">+</span>ratio<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span><span class="token number">2</span> <span class="token operator">*</span>progress<span class="token punctuation">;</span>

     <span class="token comment">// 设置填充颜色 </span>
     ctx<span class="token punctuation">.</span>fillStyle<span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>

     <span class="token comment">// 开始路径 </span>
     ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token comment">// 移动到圆心 </span>
     ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>cx <span class="token punctuation">,</span>cy<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token comment">// 绘制弧线 </span>
     ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>cx <span class="token punctuation">,</span>cy <span class="token punctuation">,</span>radius <span class="token punctuation">,</span>startAngle <span class="token punctuation">,</span>endAngle<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 填充路径 </span>
      ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 绘制标签（乘以进度变量）</span>
      <span class="token keyword">var</span> midAngle<span class="token operator">=</span> <span class="token punctuation">(</span>startAngle <span class="token operator">+</span>endAngle<span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> tx<span class="token operator">=</span> cx <span class="token operator">+</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>midAngle<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token punctuation">(</span>radius <span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> ty<span class="token operator">=</span> cy <span class="token operator">+</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>midAngle<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token punctuation">(</span>radius <span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span><span class="token string">&quot;black&quot;</span><span class="token punctuation">;</span>
      ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>label <span class="token operator">*</span>progress <span class="token punctuation">,</span>tx <span class="token punctuation">,</span>ty<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">// 更新起始角度为下一个扇形的起始角度 </span>
       startAngle<span class="token operator">=</span> endAngle<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 更新进度变量（增加一点点）</span>
    progress <span class="token operator">+=</span><span class="token number">0.01</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果进度变量小于等于1，则继续调用自身 </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>progress <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateChart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 调用更新饼状图的函数</span>
<span class="token function">updateChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),o=[e];function c(l,i){return s(),a("div",null,o)}const k=n(t,[["render",c],["__file","canvasPieChart.html.vue"]]);export{k as default};
